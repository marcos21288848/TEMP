<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- سيتم تحديث العنوان ديناميكياً -->
    <title>لوحة التحكم</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="css/admin-style.css?v=1.7">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&family=Tajawal:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- سيتم تحديث المانيفيست ديناميكياً -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/icons/apple-touch-icon.png">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut" href="favicon.ico" type="image/x-icon">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
    <header>
        <nav class="container">
            <a href="index.html" class="logo-link"><img id="header-logo" src="images/logo-main.png" alt="Logo"
                    class="logo"></a>
            <h2>لوحة تحكم الأدمن</h2>
            <button id="logout-btn" class="btn">تسجيل الخروج</button>
        </nav>
    </header>

    <main class="container page-padding" id="admin-content" style="display: none;">

        <section id="dashboard-section">
            <h2>لوحة التحليلات</h2>
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3>حجوزات معلقة</h3>
                    <p id="pending-count">0</p>
                </div>
                <div class="stat-card">
                    <h3>حجوزات اليوم</h3>
                    <p id="today-count">0</p>
                </div>
                <div class="stat-card">
                    <h3>إجمالي الحجوزات (آخر 30 يوم)</h3>
                    <p id="total-count">0</p>
                </div>
            </div>
        </section>

        <section id="reports-section">
            <h2>التقارير المتقدمة</h2>
            <div class="management-grid">
                <div class="chart-container">
                    <h3>إجمالي الحجوزات شهرياً</h3>
                    <canvas id="monthlyBookingsChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 id="top-services-chart-title">الخدمات الأكثر طلباً</h3>
                    <canvas id="topServicesChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 id="service-revenue-chart-title">إيرادات كل خدمة</h3>
                    <canvas id="serviceRevenueChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>الأيام الأكثر ازدحاماً</h3>
                    <canvas id="busiestDaysChart"></canvas>
                </div>
            </div>
        </section>

        <section id="bookings-management-section" style="display: none;">
            <h2>إدارة الحجوزات المعلقة</h2>
            <div id="pending-bookings-list"></div>
        </section>

        <section id="today-bookings-section">
            <div class="section-header">
                <h2>حجوزات اليوم الموافق عليها</h2>
                <label class="switch"><input type="checkbox" id="toggle-today-bookings"><span
                        class="slider round"></span></label>
            </div>
            <div id="today-bookings-content">
                <div id="today-bookings-list"></div>
            </div>
        </section>

        <section id="upcoming-bookings-section">
            <div class="section-header">
                <h2>الحجوزات القادمة</h2>
                <label class="switch"><input type="checkbox" id="toggle-upcoming-bookings"><span
                        class="slider round"></span></label>
            </div>
            <div id="upcoming-bookings-content" style="display: none;">
                <div id="upcoming-bookings-list"></div>
                <div class="pagination-controls" id="upcoming-pagination"></div>
            </div>
        </section>

        <section id="past-bookings-section">
            <div class="section-header">
                <h2>الحجوزات السابقة المؤكدة</h2>
                <label class="switch"><input type="checkbox" id="toggle-past-bookings"><span
                        class="slider round"></span></label>
            </div>
            <div id="past-bookings-content" style="display: none;">
                <div id="past-bookings-list"></div>
                <div class="pagination-controls" id="past-pagination"></div>
            </div>
        </section>

        <section id="booking-viewer-section">
            <h2>البحث في الحجوزات المؤكدة</h2>
            <div class="viewer-controls">
                <div class="form-group"><label for="start-date-picker">من تاريخ:</label><input type="date"
                        id="start-date-picker"></div>
                <div class="form-group"><label for="end-date-picker">إلى تاريخ:</label><input type="date"
                        id="end-date-picker"></div>
                <div class="count-display">
                    <h3>عدد الحجوزات</h3>
                    <p id="booking-count">0</p>
                </div>
            </div>
            <div id="viewer-results-container">
                <p class="note">الرجاء اختيار فترة زمنية لعرض الحجوزات.</p>
            </div>
        </section>

        <section id="services-management-section">
            <h2 id="services-management-title">إدارة الخدمات</h2>
            <div class="management-grid">
                <div>
                    <h3 id="add-service-title">إضافة خدمة جديدة</h3>
                    <form id="add-service-form">
                        <label for="service-name" id="service-name-label">اسم الخدمة:</label>
                        <input type="text" id="service-name" required>
                        <label for="service-price">السعر (بالجنيه):</label>
                        <input type="number" id="service-price" required min="0">
                        <button type="submit" class="btn btn-primary">إضافة الخدمة</button>
                    </form>
                </div>
                <div>
                    <h3 id="current-services-title">الخدمات الحالية</h3>
                    <div id="services-list">
                        <p class="note" id="loading-services-note">جاري تحميل الخدمات...</p>
                    </div>
                </div>
            </div>
        </section>
        <!-- === بداية: قسم إدارة فريق العمل (تم نقله هنا ليصبح مستقلاً وصحيحًا) === -->
        <section id="barbers-management-section">
            <h3>إدارة فريق العمل (<span class="theme-entity-plural"></span>)</h3>
            <p class="note" style="text-align: right; margin: 5px 0 15px 0; font-size: 0.85rem;">
                أضف أعضاء فريقك من هنا. سيظهرون في الصفحة الرئيسية مع صورهم ووصفهم الخاص.
            </p>

            <!-- قائمة فريق العمل الحالي -->
            <div id="barbers-list" style="margin-bottom: 25px;">
                <!-- سيتم عرض قائمة العاملين هنا بواسطة الجافاسكريبت -->
            </div>

            <hr>

            <!-- نموذج إضافة عضو جديد -->
            <h4>إضافة عضو جديد</h4>
            <form id="add-barber-form">
                <label for="new-barber-name">اسم العضو:</label>
                <input type="text" id="new-barber-name" required placeholder="اكتب الاسم هنا">

                <label for="new-barber-description">وصف العضو:</label>
                <textarea id="new-barber-description" required
                    placeholder="اكتب وصفًا موجزًا عن العضو وخبراته..."></textarea>

                <label for="new-barber-photo">صورة العضو الشخصية:</label>
                <input type="file" id="new-barber-photo" required accept="image/*"
                    style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">

                <button type="submit" id="add-barber-btn" class="btn btn-primary" style="margin-top: 15px;">إضافة
                    العضو</button>
            </form>
        </section>
        <section id="booking-model-section">
            <h2>نموذج ونظام الحجز</h2>
            <form id="booking-model-form">
                <div class="form-group toggle-switch-container">
                    <label for="require-confirmation-toggle">تفعيل تأكيد الحجز اليدوي</label>
                    <p class="note" style="text-align: right; margin: 5px 0 10px 0; font-size: 0.85rem;">عند تفعيله، يجب
                        عليك قبول الحجوزات يدوياً. عند إيقافه، يتم تأكيد جميع الحجوزات تلقائياً.</p>
                    <label class="switch"><input type="checkbox" id="require-confirmation-toggle"><span
                            class="slider round"></span></label>
                </div>
                <hr>
                <label for="booking-model-select">اختر نظام الحجز:</label>
                <select id="booking-model-select">
                    <option value="slots">نظام المواعيد (شرائح زمنية ثابتة)</option>
                    <option value="capacity">نظام الطاقة الاستيعابية (عدد ثابت)</option>
                </select>
                <div id="slots-input-container" style="display: none; margin-top: 1rem;">
                    <label for="slot-duration">مدة كل حجز (بالدقائق):</label>
                    <input type="number" id="slot-duration" min="10" step="5">
                </div>
                <div id="capacity-input-container" style="display: none; margin-top: 1rem;">
                    <label for="daily-capacity">الطاقة الاستيعابية اليومية (عدد الحجوزات):</label>
                    <input type="number" id="daily-capacity" min="1">
                </div>
                <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">حفظ النموذج</button>
            </form>
        </section>



        <section id="schedule-section">
            <h2>إعدادات أوقات العمل والراحة</h2>
            <form id="schedule-form">
                <div class="form-group-box">
                    <h3>أيام العمل</h3>
                    <div class="form-group-row">
                        <label><input type="radio" name="workday_mode" value="all" checked> كل الأيام عمل</label>
                        <label><input type="radio" name="workday_mode" value="custom"> تخصيص أيام الإجازة</label>
                    </div>
                </div>
                <div class="form-group-box">
                    <h3>فترة الراحة (Break)</h3>
                    <div class="form-group-row">
                        <label><input type="radio" name="break_mode" value="none"> لا يوجد</label>
                        <label><input type="radio" name="break_mode" value="unified" checked> فترة راحة موحدة</label>
                        <label><input type="radio" name="break_mode" value="custom"> فترة راحة مخصصة لكل يوم</label>
                    </div>
                    <div id="unified-break-inputs" style="display:none; margin-top: 1rem;">
                        <label>فترة الراحة الموحدة:</label>
                        <div class="time-input-group is-horizontal">
                            <div class="time-pair"><label>من:</label><input type="time" id="unified-break-start"></div>
                            <div class="time-pair"><label>إلى:</label><input type="time" id="unified-break-end"></div>
                        </div>
                    </div>
                </div>
                <div class="schedule-grid"></div>
                <button type="submit" class="btn btn-primary">حفظ أوقات العمل</button>
            </form>
        </section>

        <div class="management-grid">
            <section id="general-settings-section">
                <h2>الإعدادات العامة</h2>
                <form id="logo-form">
                    <label for="logo-url">رابط الشعار (URL):</label>
                    <input type="url" id="logo-url" placeholder="https://example.com/logo.png">
                    <button type="submit" class="btn btn-primary">حفظ الشعار</button>
                </form>
                <hr>
                <label>تغيير كلمة المرور:</label>
                <button id="change-password-btn" class="btn">إرسال رابط التغيير</button>
            </section>

            <section id="payment-management-section">
                <h2>إدارة طرق الدفع</h2>
                <div class="management-grid">
                    <div>
                        <h3>إضافة طريقة دفع</h3>
                        <form id="add-payment-method-form">
                            <label for="payment-method-name">اسم الطريقة:</label>
                            <input type="text" id="payment-method-name" required>
                            <label for="payment-method-details">التفاصيل:</label>
                            <input type="text" id="payment-method-details">
                            <label style="display: flex; align-items: center; gap: 8px; margin-top: 15px !important;">
                                <input type="checkbox" id="payment-method-requires-proof" checked style="width: auto;">
                                يتطلب إثبات تحويل
                            </label>
                            <button type="submit" class="btn btn-primary">إضافة</button>
                        </form>
                    </div>
                    <div>
                        <h3>طرق الدفع الحالية</h3>
                        <div id="payment-methods-list">
                            <p class="note">جاري التحميل...</p>
                        </div>
                    </div>
                </div>
                <hr>
                <h3>إعدادات تلقي الإثبات</h3>
                <form id="payment-contact-form">
                    <p class="note" style="text-align: right; margin-bottom: 10px;">الوسيلة التي سيقوم العميل بإرسال
                        إثبات التحويل إليها.</p>
                    <label>وسيلة التواصل:</label>
                    <select id="contact-platform">
                        <option value="whatsapp">واتساب</option>
                        <option value="telegram">تليجرام</option>
                        <option value="other">وسيلة أخرى</option>
                    </select>
                    <input type="text" id="contact-info" placeholder="اكتب الرقم هنا..." style="margin-top: 5px;">
                    <input type="text" id="contact-other" placeholder="اكتب اسم الوسيلة الأخرى هنا"
                        style="margin-top: 5px; display: none;">
                    <button type="submit" class="btn btn-primary">حفظ</button>
                </form>
            </section>
        </div>
    </main>

    <div id="edit-service-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-edit-service-modal">×</span>
            <h3 id="edit-service-modal-title">تعديل الخدمة</h3>
            <form id="edit-service-form">
                <input type="hidden" id="edit-service-id">
                <label for="edit-service-name" id="edit-service-name-label">اسم الخدمة:</label>
                <input type="text" id="edit-service-name" required>
                <label for="edit-service-price">السعر (بالجنيه):</label>
                <input type="number" id="edit-service-price" required min="0">
                <button type="submit" class="btn btn-primary">حفظ التعديلات</button>
            </form>
        </div>
    </div>

    <div id="edit-barber-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-edit-barber-modal">×</span>
            <h3>تعديل اسم الـ<span class="theme-entity"></span></h3>
            <form id="edit-barber-form">
                <input type="hidden" id="edit-barber-index">
                <label for="edit-barber-name">اسم الـ<span class="theme-entity"></span>:</label>
                <input type="text" id="edit-barber-name" required>
                <button type="submit" class="btn btn-primary">حفظ التعديلات</button>
            </form>
        </div>
    </div>

    <div id="edit-payment-method-modal" class="modal">
        <div class="modal-content"> <span class="close-button" id="close-edit-payment-method-modal">×</span>
            <h3>تعديل طريقة الدفع</h3>
            <form id="edit-payment-method-form"> <input type="hidden" id="edit-payment-method-id"> <label
                    for="edit-payment-method-name">اسم الطريقة:</label> <input type="text" id="edit-payment-method-name"
                    required> <label for="edit-payment-method-details">التفاصيل:</label> <input type="text"
                    id="edit-payment-method-details"> <label
                    style="display: flex; align-items: center; gap: 8px; margin-top: 15px !important;"> <input
                        type="checkbox" id="edit-payment-method-requires-proof" style="width: auto;"> يتطلب إثبات تحويل
                </label> <button type="submit" class="btn btn-primary">حفظ التعديلات</button> </form>
        </div>
    </div>

    <footer>
        <p></p>
    </footer>

    <!-- بداية: ترتيب تحميل السكريبتات الصحيح -->
    <script src="js/config.js"></script>
    <script src="js/themer.js"></script> <!-- ✨ تم إضافة هذا الملف هنا -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/admin.js?v=2.9"></script>
    <!-- نهاية: ترتيب تحميل السكريبتات الصحيح -->

    <audio id="notification-sound" src="sounds/notification.mp3" preload="auto"></audio>
</body>

</html>